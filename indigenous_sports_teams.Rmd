---
title: "Indigenous Sports Teams Viz - r/DataVizRequests"
output: html_notebook
---


```{r}


library(reticulate)
use_python("C:/Users/rodrigo.revilla/AppData/Local/Programs/Python/Python38")


```

```{r}

library(rvest)
library(stringr)
library(dplyr)
library(jsonlite)

site = read_html("https://en.wikipedia.org/wiki/List_of_secondary_school_sports_team_names_and_mascots_derived_from_indigenous_peoples")
links <- html_nodes(site, "a")
city_link <-bind_rows(lapply(xml_attrs(links), function(x) data.frame(as.list(x), stringsAsFactors=FALSE)))
city_link <- city_link %>% filter(grepl(",",title)) %>% filter(!grepl("High|School",title)) %>% select(href,title)


#FUNCIÃ“N QUE REGRESA LAT, LONG

lat_lon  <- function(city_url){
  wiki_name <- str_replace(city_url,"/wiki/","")
  tryCatch({
  json_url<-paste("https://en.wikipedia.org/w/api.php?action=query&prop=coordinates&titles=",wiki_name,"&format=json",sep="") %>% fromJSON()
  lat<-json_url$query$pages[[1]]$coordinates$lat
  lon<-json_url$query$pages[[1]]$coordinates$lon
  coords <- paste(lat,lon,sep=",")
  if (identical(coords,character(0))) {
        wiki_name <- gsub(",.*","\\1",wiki_name)
        json_url<-paste("https://en.wikipedia.org/w/api.php?action=query&prop=coordinates&titles=",wiki_name,"&format=json",sep="") %>%             fromJSON()
        lat<-json_url$query$pages[[1]]$coordinates$lat
        lon<-json_url$query$pages[[1]]$coordinates$lon
        coords <- paste(lat,lon,sep=",")
  }
  return(coords)
  },error=function(e) {return("error")})
}


ppppp<-lapply(city_link$href, lat_lon)
ppppp %>% data.frame(ppppp)
city_link$coordinates <- ppppp


```

